<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathChallenge - Juego de Matemáticas</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            text-align: center;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            max-width: 600px;
            width: 90%;
        }
        
        h1 {
            color: #4a6fa5;
        }
        
        input, button {
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
        }
        
        button {
            background-color: #4a6fa5;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #3a5a8a;
        }
        
        #gameScreen {
            display: none;
        }
        
        .problem {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .option {
            padding: 10px;
            background-color: #e0e8f5;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .option:hover {
            background-color: #d0dcf0;
        }
        
        .correct {
            background-color: #4caf50 !important;
            color: white;
        }
        
        .incorrect {
            background-color: #f44336 !important;
            color: white;
        }
        
        .status {
            display: flex;
            justify-content: space-between;
            background-color: #4a6fa5;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        /* Barra de tiempo */
        .timer-bar-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            margin: 10px 0;
            height: 10px;
        }
        
        .timer-bar {
            height: 100%;
            width: 100%;
            background-color: #e74c3c;
            border-radius: 5px;
            transition: width 1s linear;
        }
        
        /* Selector de dificultad */
        .difficulty-selector {
            margin: 15px 0;
        }

        .difficulty-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .difficulty-button {
            padding: 8px 15px;
            background-color: #e0e8f5;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .difficulty-button:hover {
            background-color: #d0dcf0;
        }

        .difficulty-button.selected {
            background-color: #4a6fa5;
            color: white;
        }
        
        /* Tabla de clasificación */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #4a6fa5;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MathChallenge</h1>
        
        <!-- Pantalla de Inicio -->
        <div id="loginScreen">
            <input type="text" id="nameInput" placeholder="Tu nombre de jugador">
            
            <!-- Selector de dificultad -->
            <div class="difficulty-selector">
                <p>Selecciona la dificultad:</p>
                <div class="difficulty-buttons">
                    <button class="difficulty-button selected" id="easy-button">Fácil</button>
                    <button class="difficulty-button" id="medium-button">Medio</button>
                    <button class="difficulty-button" id="hard-button">Difícil</button>
                </div>
            </div>
            
            <button id="startButton">Comenzar Juego</button>
        </div>
        
        <!-- Pantalla de Juego -->
        <div id="gameScreen">
            <div class="status">
                <div>Jugador: <span id="playerName"></span></div>
                <div>Puntos: <span id="score">0</span></div>
                <div>Tiempo: <span id="timer">30</span>s</div>
            </div>
            
            <!-- Barra de tiempo -->
            <div class="timer-bar-container">
                <div class="timer-bar" id="timerBar"></div>
            </div>
            
            <div class="problem" id="problem"></div>
            
            <div class="options" id="options">
                <!-- Opciones generadas dinámicamente -->
            </div>
            
            <div id="results" style="display: none;">
                <h2>¡Fin del Juego!</h2>
                <p>Puntuación Final: <span id="finalScore">0</span></p>
                <button id="restartButton">Jugar de Nuevo</button>
            </div>
        </div>
    </div>
    
    <!-- Tabla de Clasificación -->
    <div class="container">
        <h2>Tabla de Clasificación</h2>
        <table>
            <tr>
                <th>Posición</th>
                <th>Jugador</th>
                <th>Dificultad</th>
                <th>Puntuación</th>
            </tr>
            <tbody id="leaderboard">
                <!-- Puntuaciones generadas dinámicamente -->
            </tbody>
        </table>
    </div>
    
    <script>
        // Variables
        let playerName = "";
        let score = 0;
        let timer = 30;
        let timerInterval;
        let currentProblem = {};
        let highScores = [];
        let difficulty = "easy"; // Valores posibles: "easy", "medium", "hard"
        
        // Elementos DOM
        const loginScreen = document.getElementById('loginScreen');
        const gameScreen = document.getElementById('gameScreen');
        const nameInput = document.getElementById('nameInput');
        const startButton = document.getElementById('startButton');
        const playerNameEl = document.getElementById('playerName');
        const scoreEl = document.getElementById('score');
        const timerEl = document.getElementById('timer');
        const timerBarEl = document.getElementById('timerBar');
        const problemEl = document.getElementById('problem');
        const optionsEl = document.getElementById('options');
        const resultsEl = document.getElementById('results');
        const finalScoreEl = document.getElementById('finalScore');
        const restartButton = document.getElementById('restartButton');
        const leaderboardEl = document.getElementById('leaderboard');
        const easyButton = document.getElementById('easy-button');
        const mediumButton = document.getElementById('medium-button');
        const hardButton = document.getElementById('hard-button');
        
        // Evento de inicio
        startButton.onclick = function() {
            const name = nameInput.value.trim();
            if (name) {
                playerName = name;
                playerNameEl.textContent = name;
                loginScreen.style.display = 'none';
                gameScreen.style.display = 'block';
                startGame();
            } else {
                alert('Por favor ingresa tu nombre');
            }
        };
        
        // Enter key para nombre
        nameInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                startButton.click();
            }
        });
        
        // Eventos de dificultad
        easyButton.addEventListener('click', function() {
            setDifficulty('easy');
        });

        mediumButton.addEventListener('click', function() {
            setDifficulty('medium');
        });

        hardButton.addEventListener('click', function() {
            setDifficulty('hard');
        });
        
        // Reiniciar juego
        restartButton.onclick = function() {
            resultsEl.style.display = 'none';
            startGame();
        };
        
        // Establecer dificultad
        function setDifficulty(level) {
            difficulty = level;
            
            // Actualizar estilos de botones
            easyButton.classList.remove('selected');
            mediumButton.classList.remove('selected');
            hardButton.classList.remove('selected');
            
            if (level === 'easy') {
                easyButton.classList.add('selected');
            } else if (level === 'medium') {
                mediumButton.classList.add('selected');
            } else if (level === 'hard') {
                hardButton.classList.add('selected');
            }
        }
        
        // Iniciar juego
        function startGame() {
            score = 0;
            
            // Ajustar tiempo según dificultad
            if (difficulty === 'easy') {
                timer = 30;
            } else if (difficulty === 'medium') {
                timer = 25;
            } else if (difficulty === 'hard') {
                timer = 20;
            }
            
            scoreEl.textContent = '0';
            timerEl.textContent = timer;
            timerBarEl.style.width = '100%';
            generateProblem();
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        // Actualizar temporizador
        function updateTimer() {
            timer--;
            timerEl.textContent = timer;
            
            // Obtener el tiempo máximo según la dificultad
            let maxTime;
            if (difficulty === 'easy') {
                maxTime = 30;
            } else if (difficulty === 'medium') {
                maxTime = 25;
            } else {
                maxTime = 20;
            }
            
            // Actualizar barra de tiempo
            const timerPercentage = (timer / maxTime) * 100;
            timerBarEl.style.width = timerPercentage + '%';
            
            if (timer <= 0) {
                clearInterval(timerInterval);
                showResults();
            }
        }
        
        // Generar problema
        function generateProblem() {
            let num1, num2, operations;
            
            // Configurar según dificultad
            if (difficulty === 'easy') {
                num1 = Math.floor(Math.random() * 10) + 1; // 1-10
                num2 = Math.floor(Math.random() * 10) + 1;
                operations = ['+', '-'];
            } else if (difficulty === 'medium') {
                num1 = Math.floor(Math.random() * 20) + 1; // 1-20
                num2 = Math.floor(Math.random() * 20) + 1;
                operations = ['+', '-', '×'];
            } else if (difficulty === 'hard') {
                num1 = Math.floor(Math.random() * 30) + 1; // 1-30
                num2 = Math.floor(Math.random() * 30) + 1;
                operations = ['+', '-', '×', '÷'];
            }
            
            // Elegir operación aleatoria
            const operation = operations[Math.floor(Math.random() * operations.length)];
            
            // Calcular resultado
            let correctAnswer;
            if (operation === '+') {
                correctAnswer = num1 + num2;
            } else if (operation === '-') {
                // Asegurar que el resultado no sea negativo
                if (num1 < num2) {
                    [num1, num2] = [num2, num1]; // Intercambiar para evitar negativo
                }
                correctAnswer = num1 - num2;
            } else if (operation === '×') {
                correctAnswer = num1 * num2;
            } else if (operation === '÷') {
                // Para división, aseguramos que sea exacta
                correctAnswer = num2; // Guardamos el divisor como respuesta correcta
                num1 = num2 * Math.floor(Math.random() * 10 + 1); // Multiplicamos para que la división sea exacta
            }
            
            // Crear texto del problema
            let problemText = `${num1} ${operation} ${num2}`;
            
            // Generar opciones (16 en total - 4x4 grid)
            const options = [correctAnswer];
            while (options.length < 16) {
                // Opciones con valores cercanos al correcto para aumentar dificultad
                let randomOffset = Math.floor(Math.random() * 10) - 5; // -5 a +5
                let randomOption;
                
                if (Math.random() > 0.7) {
                    // Cerca del correcto para confundir
                    randomOption = correctAnswer + randomOffset;
                } else {
                    // Completamente aleatorio
                    let maxRandom = correctAnswer * 2;
                    randomOption = Math.floor(Math.random() * maxRandom) + 1;
                }
                
                // Asegurar que sea positivo
                randomOption = Math.max(1, randomOption);
                
                // Añadir si no está ya en las opciones
                if (!options.includes(randomOption)) {
                    options.push(randomOption);
                }
            }
            
            // Mezclar opciones
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            // Guardar problema actual
            currentProblem = {
                text: problemText,
                options: options,
                correctAnswer: correctAnswer
            };
            
            // Mostrar problema
            displayProblem();
        }
        
        // Mostrar problema
        function displayProblem() {
            problemEl.textContent = currentProblem.text;
            optionsEl.innerHTML = '';
            
            currentProblem.options.forEach(option => {
                const optionEl = document.createElement('div');
                optionEl.className = 'option';
                optionEl.textContent = option;
                optionEl.onclick = function() {
                    checkAnswer(option);
                };
                optionsEl.appendChild(optionEl);
            });
        }
        
        // Verificar respuesta
        function checkAnswer(selectedAnswer) {
            const options = document.querySelectorAll('.option');
            
            // Deshabilitar opciones
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                
                if (parseInt(option.textContent) === currentProblem.correctAnswer) {
                    option.classList.add('correct');
                } else if (parseInt(option.textContent) === selectedAnswer && selectedAnswer !== currentProblem.correctAnswer) {
                    option.classList.add('incorrect');
                }
            });
            
            // Comprobar respuesta
            if (selectedAnswer === currentProblem.correctAnswer) {
                // Puntaje base según dificultad
                let basePoints;
                if (difficulty === 'easy') {
                    basePoints = 5;
                } else if (difficulty === 'medium') {
                    basePoints = 10;
                } else {
                    basePoints = 15;
                }
                
                score += basePoints;
                scoreEl.textContent = score;
            }
            
            // Siguiente problema
            setTimeout(function() {
                generateProblem();
            }, 1000);
        }
        
        // Mostrar resultados
        function showResults() {
            finalScoreEl.textContent = score;
            resultsEl.style.display = 'block';
            
            // Guardar puntuación
            saveScore();
        }
        
        // Guardar puntuación
        function saveScore() {
            try {
                // Obtener puntuaciones guardadas
                let scores = [];
                try {
                    const savedScores = localStorage.getItem('mathScores');
                    if (savedScores) {
                        scores = JSON.parse(savedScores);
                    }
                } catch (e) {
                    scores = [];
                }
                
                // Añadir nueva puntuación con dificultad
                scores.push({
                    name: playerName,
                    difficulty: difficulty,
                    score: score
                });
                
                // Ordenar por puntuación
                scores.sort((a, b) => b.score - a.score);
                
                // Guardar solo las 10 mejores
                highScores = scores.slice(0, 10);
                
                // Guardar en localStorage
                try {
                    localStorage.setItem('mathScores', JSON.stringify(highScores));
                } catch (e) {
                    console.log('Error guardando puntuaciones');
                }
                
                // Actualizar tabla
                updateLeaderboard();
            } catch (e) {
                console.log('Error en saveScore', e);
            }
        }
        
        // Actualizar tabla de clasificación
        function updateLeaderboard() {
            // Limpiar tabla
            leaderboardEl.innerHTML = '';
            
            // Añadir filas
            highScores.forEach((score, index) => {
                const row = document.createElement('tr');
                
                const posCell = document.createElement('td');
                posCell.textContent = index + 1;
                
                const nameCell = document.createElement('td');
                nameCell.textContent = score.name;
                
                const difficultyCell = document.createElement('td');
                // Convertir el código de dificultad a texto legible
                let difficultyText = 'Fácil';
                if (score.difficulty === 'medium') {
                    difficultyText = 'Medio';
                } else if (score.difficulty === 'hard') {
                    difficultyText = 'Difícil';
                }
                difficultyCell.textContent = difficultyText;
                
                const scoreCell = document.createElement('td');
                scoreCell.textContent = score.score;
                
                row.appendChild(posCell);
                row.appendChild(nameCell);
                row.appendChild(difficultyCell);
                row.appendChild(scoreCell);
                
                if (score.name === playerName && score.score === parseInt(finalScoreEl.textContent)) {
                    row.style.backgroundColor = '#ffe6a8';
                }
                
                leaderboardEl.appendChild(row);
            });
        }
        
        // Cargar puntuaciones al inicio
        try {
            const savedScores = localStorage.getItem('mathScores');
            if (savedScores) {
                highScores = JSON.parse(savedScores);
                updateLeaderboard();
            }
        } catch (e) {
            console.log('Error cargando puntuaciones');
        }
    </script>
</body>
</html>
